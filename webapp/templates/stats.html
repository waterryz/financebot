{% extends "layout.html" %}
{% block content %}


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="max-w-5xl mx-auto">

    <h1 class="text-3xl font-semibold mb-8 flex items-center justify-center gap-2">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    </h1>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">

        <div class="bg-slate-900/80 rounded-3xl p-5 border border-white/10 shadow">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                üìÖ –ò—Ç–æ–≥–∏ –º–µ—Å—è—Ü–∞
            </h2>

            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span>–î–æ—Ö–æ–¥:</span>
                    <span class="text-emerald-400 font-semibold">
                        {{ stats.total_income }} ‚Ç∏
                    </span>
                </div>
                <div class="flex justify-between">
                    <span>–†–∞—Å—Ö–æ–¥:</span>
                    <span class="text-rose-400 font-semibold">
                        {{ stats.total_expense }} ‚Ç∏
                    </span>
                </div>
                <div class="flex justify-between">
                    <span>–ë–∞–ª–∞–Ω—Å:</span>
                    <span class="text-indigo-400 font-semibold">
                        {{ stats.balance }} ‚Ç∏
                    </span>
                </div>
            </div>
        </div>

        <div class="bg-slate-900/80 rounded-3xl p-5 border border-white/10 shadow">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                üî• –¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            </h2>

            <div class="space-y-1 text-sm">
                {% if stats.top_categories %}
                    {% for name, total in stats.top_categories %}
                        <div class="flex justify-between">
                            <span>{{ name }}</span>
                            <span class="text-indigo-300 font-semibold">{{ total }} ‚Ç∏</span>
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-slate-500 text-sm">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
                {% endif %}
            </div>
        </div>


        <div class="bg-slate-900/80 rounded-3xl p-5 border border-white/10 shadow">
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                üßæ –ü–æ—Å–ª–µ–¥–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
            </h2>

            {% if stats.last_transaction %}
                <div class="text-sm space-y-1">
                    <div class="flex justify-between">
                        <span>–°—É–º–º–∞:</span>
                        <span class="{% if stats.last_transaction.type == 'income' %}text-emerald-400{% else %}text-rose-400{% endif %} font-semibold">
                            {{ stats.last_transaction.amount }} ‚Ç∏
                        </span>
                    </div>

                    <div class="flex justify-between">
                        <span>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
                        <span class="text-slate-300">{{ stats.last_transaction.category }}</span>
                    </div>

                    <div class="flex justify-between">
                        <span>–û–ø–∏—Å–∞–Ω–∏–µ:</span>
                        <span class="text-slate-400">
                            {{ stats.last_transaction.description or '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è' }}
                        </span>
                    </div>

                    <div class="flex justify-between text-xs text-slate-500 pt-1">
                        <span>–î–∞—Ç–∞:</span>
                        <span>{{ stats.last_transaction.date }}</span>
                    </div>
                </div>
            {% else %}
                <p class="text-slate-500 text-sm">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</p>
            {% endif %}
        </div>

    </div>

    <div class="mt-4">
        <h2 class="text-xl font-semibold mb-4 flex items-center gap-2">
            üìà –î–∏–Ω–∞–º–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –ø–æ –¥–Ω—è–º
        </h2>

        <div class="bg-slate-900/80 rounded-3xl p-5 border border-white/10 shadow">
            <canvas id="expenseChart" height="130"></canvas>
        </div>
    </div>

</div>

<script>
    const labels = {{ stats.daily_expenses | map(attribute=0) | list | tojson }};
    const values = {{ stats.daily_expenses | map(attribute=1) | list | tojson }};

    new Chart(document.getElementById('expenseChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: "–†–∞—Å—Ö–æ–¥—ã",
                data: values,
                borderWidth: 3,
                tension: 0.3,
                pointRadius: 4,
                borderColor: "rgb(99,102,241)",        // indigo-500
                backgroundColor: "rgba(99,102,241,0.2)"
            }]
        },
        options: {
            plugins: {
                legend: { display: false }
            },
            scales: {
                x: {
                    ticks: { color: '#aaa' },
                    grid: { color: 'rgba(255,255,255,0.05)' }
                },
                y: {
                    ticks: { color: '#aaa' },
                    grid: { color: 'rgba(255,255,255,0.05)' }
                }
            }
        }
    });
</script>

{% endblock %}
